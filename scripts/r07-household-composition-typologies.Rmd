---
title: "Vietnam FoF Survey---Household Composition Typology"
author: maja
date: "10.10.2018"
tables: yes
output:
  pdf_document:
    toc: true
    number_sections: true
    toc_depth: 3
toc: yes
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../reports") })
bibliography: ../reports/bib.bib
editor_options: 
  chunk_output_type: console
---
  
```{r setup, include=FALSE, message = FALSE, warning = FALSE, echo= FALSE}
## this is to set up the main folder as the root
## although this doesnot work for the YAML designations e.g. bibliography, css files etc..:(
require(knitr)
require(dplyr)
require(memisc)

# opts_knit$set(root.dir = "/home/mz/Dropbox/analysis/Vietnam/VietnamSurvey")
# opts_knit$set(root.dir = "C:/Users/sfos0247/Dropbox/analysis/Vietnam/VietnamSurvey")
```


```{r intro, echo = FALSE, warning = FALSE, message = FALSE}
load(here::here("data/outputs/clean.Rdata"))

#  select only women over the age of 50 
ds.hohh[ds.hohh$a1 == "Female"& ds.hohh$a2 <= 1966, ] -> ds.hohh.w.50
ds.mmbr[ds.mmbr$hh.id %in% ds.hohh.w.50$hh.id , ] -> ds.mmbr.w.50

# now summarize back to number of households
ds.mmbr %>% 
  subset(n4 == 1) ->
  ds.hh.sums

ds.mmbr.w.50 %>% 
  subset(n4 == 1) ->
  ds.hh.sums.w.50

```  
# Intro

This material is prepared as discussed in the 3.10. meeting with SH, GWL and KH as a potential basis for SH's paper on older women based on the Vientam survey data. 

I set out the typologies and the data first. 

# Household typologies

I start out with two typologies: 

1. *Family-based*: The UN recommended household classification based on family nuclei and the relationship between the nuclei and other members in the hosuehold (see @un2017principles)
2. *Generation-based*: An ad-hoc classification I used in the household living arrangemnts factsheet (@2016mz) and is based on the generational structure of the household. 

These two typologies can of course be modified, depending on what you want to focus on.

## Family-based classification (four-way)

At the top level this classificaiton has four main types (see @un2017principles): 

1. *One person household*—A single person living alone. This is defined the same in both typologies presented here.
2. *Nuclear household*—a couple with or without children, or a single parent.
3. *Extended household*—members beyond the family nucleus are related by blood or marriage.
4. *Composite household*-other persons are present who are not related to the head.

Unfortunately our questionnaire only had one option for a non-related household member which was `House servant` which means that there is only one household in the whole sample which can be considered composite. 

**Table 1:** Proportion of households of each *Family-based typology* type - four-way classification 

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}

all <- c(100*prop.table(summary(ds.hh.sums$hh.type.fam)), nrow(ds.hh.sums))
names(all)[5] <- "N"
w.50 <- c(100* prop.table(c(summary(ds.hh.sums.w.50$hh.type.fam), 0)), 
          nrow(ds.hh.sums.w.50))

names(w.50)[4:5] <- c("composite", "N")
knitr::kable(rbind("Family type - all" = all, 
                   "Family type - women over 50" = w.50),
             "latex", booktabs = T, digits = 2)

par(mfrow = c(1,2))
par(mar = c(2.5,4,4,1))
barplot(prop.table(table(ds.hh.sums$hh.type.fam)),  xlab = "", 
        col = "white", xlim = c(0, .6),
        cex.names =  .6, horiz = TRUE, las = 2)
mtext(side = 3, "Family typology - all")
x <- prop.table(c(table(ds.hh.sums.w.50$hh.type.fam), 0))
names(x)[4] <- "composite"
barplot(x,  xlab = "", 
        col = "white", border = c( rep("black", 3), NA),  xlim = c(0, .6),
        cex.names  = .6,  horiz = TRUE, las = 2)
mtext(side = 3, "Family typology - women over 50")
rm(x)
```


### Family-based classification (expanded)

One way to expand on the original family-based classificaiton is to distinguish whether or not the respondent has a spouse in the household or not. This is done by checking if anyone with the code *2-Spouse* is in the household


## Generation-based classification

At the top level this classificaiton has five main types: 

1. *One person household*—A single person living alone. This is defined the same in both typologies presented here.
2. *One generation household*—at least one more person of the same age group as the head Usually a spouse, but can also be sibling etc.
3. *Two generation household*—at least one more person one generation younger/older than the head. Usually child(ren), can also be parent etc. 
4. *Three or more generation household*—at least two more persons of different generations than the head (but without skipping generations).
5. *Skipped generation household*—at least one generation missing. Usually head with grandchildren but without children.


#  Available data

## `n4 - Relationship with the respondent`

The main variable of interest, `n4 - Relationship with the respondent`, has the following values and distribution in the population of households members living in households headed[^1] by women over the age of 50 (N = `r nrow(ds.mmbr.w.50)`):

**Table and Figure :** Distribution of types of relationships with respondents in the survey sample (percentage)
```{r prepare, echo = FALSE, warning = FALSE, message = FALSE}
all <- c(100*prop.table(summary(ds.mmbr$n4)), nrow(ds.mmbr))
names(all)[15] <- "N"
x <- summary(ds.mmbr.w.50$n4)
x <- c(x[1:8], 0, x[9:12])
x <- c(x[1:12], 0, x[13])
names(x) <- names(all)[1:14]
w.50 <- c(100*prop.table(x), nrow(ds.mmbr.w.50))
names(w.50) <- names(all)
knitr::kable(cbind(all = all, 
                   women_over_50 = w.50),
             "latex", booktabs = T, digits = 2)

par(mfrow = c(1,2))
par(mar = c(2.5,4,4,1))
barplot(prop.table(summary(ds.mmbr$n4)),    xlim = c(0, .3),
        xlab = "", horiz = TRUE, col = "white", las = 2, cex.names = 0.6,
        cex.axis = 0.8)
mtext("Relationship  - all", side = 3)
barplot(prop.table(x),  xlim = c(0, .3),
        xlab = "", horiz = TRUE, col = "white", las = 2,cex.names = 0.6,
        border = c(rep("black", 8), "white", rep("black", 3), "white", "black"),
        cex.axis = 0.8)
mtext("Relationship  - women over 50", side = 3)
```


# Data Preparation - Variables of Interest

The following variables are derived in order to facilitate the identificiation of household types:

## `hh.size` - Household size

The average household size overall is `r round(mean(ds.hh.sums$hh.size), 2)` and is slightly higher for the households headed by women over 50 at `r round(mean(ds.hh.sums.w.50$hh.size),2)`. 

**Table and Figure :** Distribution of household sizes in the sample (percentage)

```{r echo = FALSE, fig.height = 4, fig.width = 8}

all <- c(summary(ds.hh.sums$hh.size), nrow(ds.hh.sums))
names(all)[7] <- "N"
w.50 <- c(summary(ds.hh.sums.w.50$hh.size), nrow(ds.hh.sums.w.50))
names(w.50)[7] <- "N"
knitr::kable(rbind("hh.size - all" = all, 
                   "hh.size - women over 50" = w.50),
             "latex", booktabs = T, digits = 2)

par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
hist(ds.hh.sums$hh.size, xlab = "", ylim = c(0,.35), main = "",
          breaks = seq(0.5, 11.5, 1), freq = FALSE)
mtext(side = 3,  "Household size - all")
hist(ds.hh.sums.w.50$hh.size, xlab = "", ylim = c(0,.35), main = "",
      breaks = seq(0.5, 11.5, 1), freq = FALSE)
mtext(side = 3, "Household size - women over 50")
```


## `hh.size.net` - Household size net of migrants

The average net household size i.e. subtracting the persons not currently living in the household is `r round(mean(ds.hh.sums$hh.size.net),2)` for the whole sample and `r round(mean(ds.hh.sums.w.50$hh.size.net), 2)` for those headed by wome over 50. 

The average numer of members not living in the household---this is the difference between the household size (previous variable) and the hosuehold size net of migrants (this variable)--is around 0.27 per household or rather 0.28 per household for the women over 50 sample. 

**Table and Figure :** Distribution of household sizes net of migrants in the sample (percentage)

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}

all <- c(summary(ds.hh.sums$hh.size.net), nrow(ds.hh.sums))
names(all)[7] <- "N"
w.50 <- c(summary(ds.hh.sums.w.50$hh.size.net), nrow(ds.hh.sums.w.50))
names(w.50)[7] <- "N"
knitr::kable(rbind("hh.size - all" = all, 
                   "hh.size - women over 50" = w.50),
             "latex", booktabs = T, digits = 2)

par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
hist(ds.hh.sums$hh.size.net, xlab = "", ylim = c(0,.35), main = "",
          breaks = seq(0.5, 11.5, 1), freq = FALSE)
mtext(side = 3,  "Household size - all")
hist(ds.hh.sums.w.50$hh.size.net, xlab = "", ylim = c(0,.35), main = "",
      breaks = seq(0.5, 11.5, 1), freq = FALSE)
mtext(side = 3, "Household size - women over 50")

```

##  `gen` - generation code relative to the respondent

The respondent is categorized as generation 0, as are their spouse and siblings. Children are coded as 1, grandchildren as 2 etc. [^2]. 

This is an odd variable to interpret as an average, but the larger it is, the more the sample tends towards younger generations. It is larger for the female headed households (.82 vs .70) and from the plots it looks like this is mainly to do with there being fewer people in the same generation (0), most likely spouses. 


**Table and Figure :** Distribution of the relative generation of each individual relative to their respondent  (percentage)

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}
all <- c(summary(ds.mmbr$gen), nrow(ds.mmbr))
names(all)[9] <- "N"
w.50 <-c( summary(ds.mmbr.w.50$gen), nrow(ds.mmbr.w.50))
names(w.50)[9] <- "N"
knitr::kable(rbind("gen - all" = all, 
                   "gen - women over 50" = w.50),
             "latex", booktabs = T,digits = 2)

par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
barplot(prop.table(table(ds.mmbr$gen)),  xlab = "", 
        col = "white", ylim = c(0, .5))
mtext(side = 3, "Relative generation - all")
x <- c(0, prop.table(table(ds.mmbr.w.50$gen)))
attributes(x)$names <- c("-2", "-1", "0", "1", "2")
barplot(x,  xlab = "", 
        col = "white", border = c(NA, rep("black", 4)),  ylim = c(0,.5))
mtext(side = 3, "Relative generation - women over 50")
rm(x)
```


## `n.gen` - Number of different generations in household

The modal number of different generations in each household is 3 with the average being `r round(mean(ds.hh.sums$n.gen),2)` overall and slighltly higher for female headed households at `r round(mean(ds.hh.sums.w.50$n.gen),2)`. This is due to the fact that there are proportionally fewer one generation households, and instead more three generation hosueholds, while two and four generation households remain roughly the same. 

**Table and Figure :** Distribution of number of generations in each household in the sample (percentage)

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}
all <- c(summary(ds.hh.sums$n.gen), nrow(ds.hh.sums))
names(all)[7] <- "N"
w.50 <- c(summary(ds.hh.sums.w.50$n.gen), nrow(ds.hh.sums.w.50))
names(w.50)[7] <- "N"

knitr::kable(rbind("n.gen all" = all , 
                   "n.gen women over 50" = w.50),
             "latex", booktabs = T, digits = 2)

par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
barplot(prop.table(table(ds.hh.sums$n.gen)), xlab = "", 
        col = "white", ylim = c(0, .5))
mtext(side = 3,  "Number of gens- all")
barplot(prop.table(table(ds.hh.sums.w.50$n.gen)),  xlab = "", 
        col = "white", ylim = c(0, .5))
mtext(side = 3, "Number of gens- women over 50")
```

##  `n.gen.net` - Number of different generations in household net of migrants

Same as the previous variable, but not counting members of the household not living at home. Again there are slightly more generations in female headed households at 2.55 vs 2.44, with the  difference between the distributions being female headed households having fewer one and two generation households and more three and four generation ones. 

**Table and Figure :** Distribution of number of generations in each household (not counting migrants) in the sample (percentage)

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}
## this is how far i got
knitr::kable(rbind("n.gen.net - all" = summary(ds.hh.sums$n.gen.net), 
                   "n.gen.net - women over 50" = summary(ds.hh.sums.w.50$n.gen.net)),
             "latex", booktabs = T)
par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
barplot(prop.table(table(ds.hh.sums$n.gen.net)), xlab = "", 
        col = "white", ylim = c(0, .7))
mtext(side = 3,  "Number of gens  - all (net)")

barplot(prop.table(table(ds.hh.sums.w.50$n.gen.net)), xlab = "", 
        col = "white", ylim = c(0, .7))
mtext(side = 3, "Number of gens- women over 50 (net)")
```


## `skipped.gen` - Whether or not a generation is skipped in the household
```{r echo = FALSE, warning = FALSE, message = FALSE}
ds.mmbr%>% 
  as.data.frame() %>% 
  group_by(hh.id) %>% 
  summarise(skipped = first(skipped.gen)) %>% 
  ungroup() %>% 
  summarise(skip = sum(skipped)) %>% 
  pull() -> skip.all
ds.mmbr.w.50 %>% 
  as.data.frame() %>% 
  group_by(hh.id) %>% 
  summarise(skipped = first(skipped.gen)) %>% 
  ungroup() %>% 
  summarise(skip = sum(skipped)) %>% 
  pull() -> skip.w.50
```

There is only a small difference in the proportion of households with skipped generations between the full sample and the women over 50 sample - 3.2 \% vs 3.4 \%. In the whole sample there are `r skip.all` households with skipped generations, and in the women over 50 sample there are `r skip.w.50`

```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}
knitr::kable(rbind("skipped.gen - all" = prop.table(table(ds.hh.sums$skipped.gen)), 
                   "skipped.gen - women over 50" = prop.table(table(ds.hh.sums.w.50$skipped.gen))),
             "latex", booktabs = T)
par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
barplot(prop.table(table(ds.hh.sums$skipped.gen)), xlab = "", 
        col = "white")
mtext(side = 3,  "Skipped generation household - all")

barplot(prop.table(table(ds.hh.sums.w.50$skipped.gen)), xlab = "", 
        col = "white")
mtext(side = 3, "Skipped generation household - women over 50")
```

## `skipped.gen.net` - Whether or not a generation is skipped in the household - net of migrants

```{r echo = FALSE, warning = FALSE, message = FALSE}
ds.mmbr%>% 
  as.data.frame() %>% 
  group_by(hh.id) %>% 
  summarise(skipped = first(skipped.gen.net)) %>% 
  ungroup() %>% 
  summarise(skip = sum(skipped)) %>% 
  pull() -> skip.all.net
ds.mmbr.w.50 %>% 
  as.data.frame() %>% 
  group_by(hh.id) %>% 
  summarise(skipped = first(skipped.gen.net)) %>% 
  ungroup() %>% 
  summarise(skip = sum(skipped)) %>% 
  pull() -> skip.w.50.net
```

As we might expect, if we remove the household members who are absent from the samples, the number of households with skipped generations increases: Now there are 4.83 \% in the entire sample and 4.65 \% in the women only, corresponding to `r skip.all.net` and `r skip.w.50.net` households respectively. Since the idea of a skipped generation household only makes sense with respect to the people actually living in the household it is this variable, net of migrant household members, that is used in the classification of households. 


```{r echo = FALSE, warning = FALSE, message = FALSE,fig.height = 4, fig.width = 8}
knitr::kable(rbind("skipped.gen - all" = prop.table(table(ds.hh.sums$skipped.gen.net)), 
                   "skipped.gen - women over 50" = prop.table(table(ds.hh.sums.w.50$skipped.gen.net))),
             "latex", booktabs = T)
par(mfrow = c(1,2))
par(mar = c(2,4,4,1))
barplot(prop.table(table(ds.hh.sums$skipped.gen.net)), xlab = "", 
        col = "white")
mtext(side = 3,  "Skipped generation household - all (net)")

barplot(prop.table(table(ds.hh.sums.w.50$skipped.gen.net)), xlab = "", 
        col = "white")
mtext(side = 3, "Skipped generation household - women over 50 (net)")
```




[^1]: It is not precisely clear to what extent these households can be said to be *headed* by these women, rather they were selected to be the respondents in this survey as they had the most knowledge or were most involved in the decision-making when it came to farming. But for simplicity I refer to them as female headed in the rest of this write up. 

[^2]: In fact we have one category for *(Great)grandchildren*, so we cannot distinguish between a level 2 and level 3 unfortunately. Furthermore *other relatives* and *house servants* are coded as missing, as generational classification is more salient between relatives. 


# References


